<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>KÃ¼mÃ¼latif Veri Takip UygulamasÄ±</title>
<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-firestore.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
<style>
* { box-sizing: border-box; margin: 0; padding: 0; }
body { font-family: 'Inter', Arial, sans-serif; padding: 10px; background-color: #f4f7f9; }
.container { display: flex; gap: 20px; margin-bottom: 20px; flex-wrap: wrap; justify-content: center; }
.data-section { background-color: white; border: 1px solid #ddd; padding: 20px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); width: 100%; max-width: 400px; }
h1 { color: #2c3e50; margin-bottom: 20px; text-align: center; font-size: 24px; }
h3 { color: #34495e; border-bottom: 2px solid #ecf0f1; padding-bottom: 10px; margin-top: 0; margin-bottom: 15px; font-size: 18px; }
.button-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 15px; }
.button-grid button { padding: 15px; font-size: 16px; cursor: pointer; border: none; border-radius: 8px; transition: all 0.2s; font-weight: bold; background-color: #ecf0f1; }
.button-grid button:hover { background-color: #bdc3c7; transform: translateY(-2px); }
.button-grid button:active { transform: translateY(0); }
#save-button { margin-top: 20px; padding: 12px 25px; background-color: #2ecc71; color: white; border: none; border-radius: 8px; cursor: pointer; width: 100%; font-size: 17px; transition: background-color 0.2s; box-shadow: 0 4px #27ae60; }
#save-button:active { box-shadow: 0 1px #27ae60; transform: translateY(3px); }
#chart-button { padding: 12px 25px; background-color: #3498db; color: white; border: none; border-radius: 8px; cursor: pointer; width: 100%; font-size: 17px; transition: background-color 0.2s; box-shadow: 0 4px #2980b9; margin-bottom: 10px; }
#chart-button:active { box-shadow: 0 1px #2980b9; transform: translateY(3px); }
.toggle-button { padding: 10px 20px; background-color: #9b59b6; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 15px; width: 100%; transition: background-color 0.2s; }
.toggle-button:hover { background-color: #8e44ad; }
.toggle-button:active { transform: translateY(2px); }
.chart-container { width: 100%; background-color: white; padding: 15px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); margin-bottom: 20px; overflow-x: auto; }
.chart-wrapper { min-width: 100%; position: relative; }
#current-cumulative-value { font-size: 20px; font-weight: bold; margin-top: 15px; text-align: center; color: #e74c3c; padding: 10px; border: 2px dashed #e74c3c; border-radius: 8px; }
input[type="date"] { padding: 10px; font-size: 16px; border: 1px solid #ccc; border-radius: 6px; width: 100%; margin-bottom: 15px; }
#selected-value { font-size: 20px; color: #2980b9; display: block; margin-bottom: 15px; }
.analysis-container { width: 100%; background-color: white; padding: 15px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); margin-top: 20px; }
.trend-box { background-color: #ecf0f1; padding: 15px; border-radius: 8px; margin: 10px 0; border-left: 4px solid #3498db; font-size: 14px; }
.trend-up { border-left-color: #2ecc71; color: #27ae60; }
.trend-down { border-left-color: #e74c3c; color: #c0392b; }
.chart-title { text-align: center; color: #2c3e50; margin-bottom: 15px; font-size: 16px; }
@media (max-width: 768px) {
.container { flex-direction: column; }
.data-section { max-width: none; }
h1 { font-size: 20px; }
.button-grid button { padding: 12px; font-size: 14px; }
}
</style>
</head>
<body>

<h1>ğŸ“… KÃ¼mÃ¼latif Veri Kaydedici</h1>

<div class="container">
<div class="data-section">
<h3>Veri GiriÅŸi</h3>
<label for="date-picker" style="font-weight: bold;">Tarih SeÃ§in:</label>
<input type="date" id="date-picker" required>
<span style="display: block; font-weight: bold;">SeÃ§ilen DeÄŸer:</span> 
<strong id="selected-value">0.00</strong>
<div class="button-grid" id="button-container"></div>
<button id="save-button" onclick="saveData()">ğŸ’¾ SeÃ§ilen DeÄŸeri Kaydet</button>
<p id="save-status" style="color: #27ae60; font-weight: bold; text-align: center; margin-top: 10px;"></p>
</div>

<div class="data-section">
<h3>Grafik & Analiz</h3>
<button id="chart-button" onclick="generateChart()">ğŸ“ˆ GrafiÄŸi Åimdi GÃ¼ncelle</button>
<button class="toggle-button" onclick="toggleChartMode()">ğŸ“Š TÃ¼m Grafik / YakÄ±n Grafik</button>
<div id="current-cumulative-value"></div>
</div>
</div>

<div class="chart-container">
<h3 class="chart-title">Grafik 1: KÃ¼mÃ¼latif Toplam</h3>
<div class="chart-wrapper">
<canvas id="cumulativeChart"></canvas>
</div>
</div>

<div class="chart-container">
<h3 class="chart-title">Grafik 2: GÃ¼nlÃ¼k DeÄŸerler</h3>
<div class="chart-wrapper">
<canvas id="dailyChart"></canvas>
</div>
</div>

<div class="chart-container">
<h3 class="chart-title">Grafik 3: KÃ¼mÃ¼latif Toplam (+1 Bonus)</h3>
<div class="chart-wrapper">
<canvas id="cumulativePlusOneChart"></canvas>
</div>
</div>

<div class="chart-container">
<h3 class="chart-title">Grafik 4: GÃ¼nlÃ¼k DeÄŸerler (+1 Bonus)</h3>
<div class="chart-wrapper">
<canvas id="dailyPlusOneChart"></canvas>
</div>
</div>

<div class="analysis-container">
<h3 style="text-align: center; color: #2c3e50; margin-bottom: 20px;">ğŸ“Š Trend Analizi</h3>
<div id="trend-analysis"></div>
</div>

<script>
const firebaseConfig = {
apiKey: "AIzaSyAIGzwmEB9F7K7KQzsEU5etVWejZ3oSluc",
authDomain: "paralayici.firebaseapp.com",
projectId: "paralayici",
storageBucket: "paralayici.firebasestorage.app",
messagingSenderId: "980843550614",
appId: "1:980843550614:web:93dd5bda4ddc377b20efb7"
};

let db;
let chartInstance1 = null;
let chartInstance2 = null;
let chartInstance3 = null;
let chartInstance4 = null;
let isFullMode = false;

const buttonValues = [-1.25, -0.25, 0.75, -1, 0, 1, -0.75, 0.25, 1.25];
let selectedValue = 0;
const collectionName = "cumulative_daily_data";

try {
firebase.initializeApp(firebaseConfig);
db = firebase.firestore();
console.log("Firebase baÅŸarÄ±yla baÅŸlatÄ±ldÄ±.");
document.getElementById('date-picker').valueAsDate = new Date();
} catch (e) {
console.error("Firebase baÅŸlatÄ±lÄ±rken kritik hata:", e);
document.body.innerHTML = "<h1>Hata</h1><p>Firebase yapÄ±landÄ±rma bilgileri yanlÄ±ÅŸ veya eksik.</p>";
}

function setupButtons() {
const container = document.getElementById('button-container');
container.innerHTML = '';
buttonValues.forEach(value => {
const button = document.createElement('button');
button.textContent = value.toFixed(2);
button.onclick = () => selectValue(value);
container.appendChild(button);
});
}

function selectValue(value) {
selectedValue = value;
document.getElementById('selected-value').textContent = value.toFixed(2);
}

function alertMessage(message, color) {
const statusElement = document.getElementById('save-status');
statusElement.textContent = message;
statusElement.style.color = color;
setTimeout(() => statusElement.textContent = '', 4000);
}

async function saveData() {
if (!db) return alertMessage("Firebase baÅŸlatÄ±lamadÄ±.", 'red');
const dateInput = document.getElementById('date-picker');
const date = dateInput.value;
if (!date) {
alertMessage("LÃ¼tfen bir tarih seÃ§in.", 'red');
return;
}
try {
await db.collection(collectionName).doc(date).set({
date: date,
value: selectedValue,
timestamp: firebase.firestore.FieldValue.serverTimestamp()
});
alertMessage(`âœ… ${date} iÃ§in ${selectedValue.toFixed(2)} kaydedildi!`, 'green');
generateChart();
} catch (error) {
console.error("Veri kaydederken hata oluÅŸtu: ", error);
alertMessage(`âŒ KayÄ±t hatasÄ±: BaÄŸlantÄ± veya yetkilendirme sorunu.`, 'red');
}
}

function toggleChartMode() {
isFullMode = !isFullMode;
generateChart();
}

function calculateTrend(data) {
if (data.length < 2) return { direction: 'neutral', percentage: 0 };
const sum = data.reduce((a, b) => a + b, 0);
const avg = sum / data.length;
const recentSum = data.slice(-Math.max(1, Math.floor(data.length / 2))).reduce((a, b) => a + b, 0);
const recentAvg = recentSum / Math.max(1, Math.floor(data.length / 2));
const change = ((recentAvg - avg) / Math.abs(avg || 1)) * 100;
if (Math.abs(change) < 5) return { direction: 'stable', percentage: change };
return { direction: change > 0 ? 'up' : 'down', percentage: change };
}

function analyzeTrends(dailyValues) {
const n = dailyValues.length;
if (n < 2) return '<p style="text-align: center; color: #7f8c8d;">Trend analizi iÃ§in yeterli veri yok.</p>';

const half = Math.floor(n / 2);
const quarter = Math.floor(n / 4);
const sixteenth = Math.floor(n / 16);

const fullData = dailyValues;
const lastHalf = dailyValues.slice(-half);
const lastQuarter = dailyValues.slice(-quarter);
const lastSixteenth = sixteenth > 0 ? dailyValues.slice(-sixteenth) : dailyValues.slice(-1);

const fullTrend = calculateTrend(fullData);
const halfTrend = calculateTrend(lastHalf);
const quarterTrend = calculateTrend(lastQuarter);
const sixteenthTrend = calculateTrend(lastSixteenth);

function getTrendText(trend, label) {
let icon = 'ğŸ“Š';
let className = '';
let text = '';
if (trend.direction === 'up') {
icon = 'ğŸ“ˆ';
className = 'trend-up';
text = `<strong>${label}:</strong> ArtÄ±ÅŸ trendinde (${trend.percentage.toFixed(1)}% yÃ¼kseliÅŸ)`;
} else if (trend.direction === 'down') {
icon = 'ğŸ“‰';
className = 'trend-down';
text = `<strong>${label}:</strong> AzalÄ±ÅŸ trendinde (${Math.abs(trend.percentage).toFixed(1)}% dÃ¼ÅŸÃ¼ÅŸ)`;
} else {
icon = 'â¡ï¸';
text = `<strong>${label}:</strong> Stabil trend (${trend.percentage.toFixed(1)}% deÄŸiÅŸim)`;
}
return `<div class="trend-box ${className}">${icon} ${text}</div>`;
}

return `
${getTrendText(fullTrend, 'TÃ¼m Veriler')}
${getTrendText(halfTrend, `Son YarÄ± (${half} gÃ¼n)`)}
${getTrendText(quarterTrend, `Son Ã‡eyrek (${quarter} gÃ¼n)`)}
${getTrendText(sixteenthTrend, `Son 1/16 (${lastSixteenth.length} gÃ¼n)`)}
`;
}

async function generateChart() {
if (!db) return;

const snapshot = await db.collection(collectionName).orderBy("date", "asc").get();

if (snapshot.empty) {
if (chartInstance1) chartInstance1.destroy();
if (chartInstance2) chartInstance2.destroy();
if (chartInstance3) chartInstance3.destroy();
if (chartInstance4) chartInstance4.destroy();
document.getElementById('current-cumulative-value').innerHTML = '**BugÃ¼nkÃ¼ KÃ¼mÃ¼latif DeÄŸer:** 0.00 (Veri Yok)';
document.getElementById('trend-analysis').innerHTML = '<p style="text-align: center; color: #7f8c8d;">Veri yok.</p>';
return;
}

const allData = [];
snapshot.forEach(doc => allData.push(doc.data()));

let cumulativeSum = 0;
let cumulativeSumPlusOne = 0;
const labels = [];
const dailyValues = [];
const cumulativeData = [];
const dailyPlusOneValues = [];
const cumulativePlusOneData = [];

allData.forEach(item => {
cumulativeSum += item.value;
cumulativeSumPlusOne += (item.value + 1);
labels.push(item.date);
dailyValues.push(item.value);
cumulativeData.push(cumulativeSum);
dailyPlusOneValues.push(item.value + 1);
cumulativePlusOneData.push(cumulativeSumPlusOne);
});

const finalCumulativeValue = cumulativeSum.toFixed(2);
document.getElementById('current-cumulative-value').innerHTML = `**BugÃ¼nkÃ¼ KÃ¼mÃ¼latif DeÄŸer:** ${finalCumulativeValue}`;

document.getElementById('trend-analysis').innerHTML = analyzeTrends(dailyValues);

const chartWidth = isFullMode ? Math.max(600, labels.length * 50) : '100%';

const chartOptions = {
responsive: true,
maintainAspectRatio: !isFullMode,
aspectRatio: isFullMode ? 3 : 2,
plugins: {
legend: { display: false }
},
scales: {
x: {
title: { display: true, text: 'Tarih', font: { size: 12 } },
grid: { display: false }
},
y: {
title: { display: true, text: 'DeÄŸer', font: { size: 12 } },
beginAtZero: false
}
}
};

if (chartInstance1) chartInstance1.destroy();
const ctx1 = document.getElementById('cumulativeChart').getContext('2d');
document.getElementById('cumulativeChart').parentElement.style.width = chartWidth;
chartInstance1 = new Chart(ctx1, {
type: 'line',
data: {
labels: labels,
datasets: [{
label: 'KÃ¼mÃ¼latif DeÄŸer',
data: cumulativeData,
borderColor: '#3498db',
backgroundColor: 'rgba(52, 152, 219, 0.2)',
tension: 0.3,
fill: true,
pointRadius: 4,
pointBackgroundColor: '#2ecc71',
borderWidth: 2
}]
},
options: chartOptions
});

if (chartInstance2) chartInstance2.destroy();
const ctx2 = document.getElementById('dailyChart').getContext('2d');
document.getElementById('dailyChart').parentElement.style.width = chartWidth;
chartInstance2 = new Chart(ctx2, {
type: 'bar',
data: {
labels: labels,
datasets: [{
label: 'GÃ¼nlÃ¼k DeÄŸer',
data: dailyValues,
backgroundColor: dailyValues.map(v => v >= 0 ? 'rgba(46, 204, 113, 0.6)' : 'rgba(231, 76, 60, 0.6)'),
borderColor: dailyValues.map(v => v >= 0 ? '#2ecc71' : '#e74c3c'),
borderWidth: 2
}]
},
options: chartOptions
});

if (chartInstance3) chartInstance3.destroy();
const ctx3 = document.getElementById('cumulativePlusOneChart').getContext('2d');
document.getElementById('cumulativePlusOneChart').parentElement.style.width = chartWidth;
chartInstance3 = new Chart(ctx3, {
type: 'line',
data: {
labels: labels,
datasets: [{
label: 'KÃ¼mÃ¼latif DeÄŸer (+1)',
data: cumulativePlusOneData,
borderColor: '#9b59b6',
backgroundColor: 'rgba(155, 89, 182, 0.2)',
tension: 0.3,
fill: true,
pointRadius: 4,
pointBackgroundColor: '#8e44ad',
borderWidth: 2
}]
},
options: chartOptions
});

if (chartInstance4) chartInstance4.destroy();
const ctx4 = document.getElementById('dailyPlusOneChart').getContext('2d');
document.getElementById('dailyPlusOneChart').parentElement.style.width = chartWidth;
chartInstance4 = new Chart(ctx4, {
type: 'bar',
data: {
labels: labels,
datasets: [{
label: 'GÃ¼nlÃ¼k DeÄŸer (+1)',
data: dailyPlusOneValues,
backgroundColor: dailyPlusOneValues.map(v => v >= 0 ? 'rgba(46, 204, 113, 0.6)' : 'rgba(231, 76, 60, 0.6)'),
borderColor: dailyPlusOneValues.map(v => v >= 0 ? '#2ecc71' : '#e74c3c'),
borderWidth: 2
}]
},
options: chartOptions
});
}

window.onload = () => {
setupButtons();
generateChart();
};
</script>

</body>
</html>
